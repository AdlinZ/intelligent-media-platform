# 内容编辑器调试指南

## 当前问题状态

1. ✅ **测试保存成功** - 数据库连接和基本保存逻辑正常
2. ❌ **AI生成内容报错** - LLM API模型不存在
3. ❌ **实际保存内容失败** - 可能是认证问题

## 已修复的问题

### 1. AI生成内容问题
- **问题**: LLM API模型名称错误 `Qwen/Qwen2.5-VL-72B-Instruct`
- **修复**: 改为 `qwen2.5-72b-instruct`
- **备选方案**: 启用本地模式 `llm.local-mode=true`

### 2. 数据库外键约束问题
- **问题**: `topic_id` 和 `created_by` 字段为 `NOT NULL`
- **修复**: 允许这些字段为 `NULL`，使用 `ON DELETE SET NULL`

### 3. 用户认证问题
- **问题**: 缺少用户认证逻辑
- **修复**: 添加JWT token验证和用户信息获取

### 4. 默认用户密码问题
- **问题**: 默认admin用户密码哈希值错误
- **修复**: 使用正确的BCrypt哈希值

## 测试步骤

### 步骤1: 重新启动应用
```bash
# 重新编译并启动Spring Boot应用
mvn clean compile
mvn spring-boot:run
```

### 步骤2: 更新数据库
```sql
-- 执行更新后的database-setup.sql
-- 或者手动更新默认用户密码
UPDATE users SET password = '$2a$10$N.zmdr9k7uOCQb376NoUnuTJ8iAt6Z5EHsM8lE9lBOsl7iKTVEFDa' WHERE username = 'admin';
```

### 步骤3: 测试登录
1. 访问内容编辑器页面
2. 点击"快速登录"按钮
3. 检查浏览器控制台是否显示登录成功
4. 确认localStorage中有token

### 步骤4: 测试AI生成
1. 点击"AI生成内容"按钮
2. 应该使用本地模板生成内容（因为启用了本地模式）
3. 检查是否生成内容成功

### 步骤5: 测试保存功能
1. 确保已登录（有token）
2. 编辑或生成内容
3. 点击"保存内容"按钮
4. 检查是否保存成功

## 调试信息

### 前端调试
- 打开浏览器开发者工具
- 查看Console标签页的日志
- 查看Network标签页的API请求

### 后端调试
- 查看Spring Boot控制台日志
- 检查是否有异常信息
- 确认数据库连接正常

## 常见问题解决

### 1. 登录失败
- 检查数据库中的用户是否存在
- 确认密码哈希值正确
- 检查JWT配置是否正确

### 2. 保存失败
- 确认用户已登录（有token）
- 检查请求头中是否包含Authorization
- 查看后端日志中的错误信息

### 3. AI生成失败
- 如果API调用失败，会自动使用本地模板
- 检查本地模板文件是否存在
- 确认LLM配置正确

## 验证成功的标志

1. ✅ 快速登录成功，显示"快速登录成功"
2. ✅ AI生成内容成功，编辑器中有内容
3. ✅ 保存内容成功，显示"内容保存成功"
4. ✅ 数据库中contents表有新记录

## 如果仍有问题

1. 检查浏览器控制台错误信息
2. 检查后端日志错误信息
3. 确认数据库连接和表结构正确
4. 验证JWT token是否有效 